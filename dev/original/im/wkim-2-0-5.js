!function e(t,n,s){function o(r,a){if(!n[r]){if(!t[r]){var c="function"==typeof require&&require;if(!a&&c)return c(r,!0);if(i)return i(r,!0);var d=new Error("Cannot find module '"+r+"'");throw d.code="MODULE_NOT_FOUND",d}var u=n[r]={exports:{}};t[r][0].call(u.exports,function(e){var n=t[r][1][e];return o(n?n:e)},u,u.exports,e,t,n,s)}return n[r].exports}for(var i="function"==typeof require&&require,r=0;r<s.length;r++)o(s[r]);return o}({1:[function(e,t,n){function s(e){this._im=e,this._OAuthI=o["interface"].OAuthI(e.ws),this._message=e.message}var o=e("../net/entry"),i=e("../../libs/storage/storage"),r=(e("../../libs/tools/log"),e("../../libs/tools/deviceId")),a=e("../../libs/tools/method");s.prototype.login=function(e,t){function n(e){return function(t){200===t.code?(s._im.openId=t.body.openId,window.sessionStorage&&i.session.setItem("WKim_loginInfo",JSON.stringify(t)),s._im.subscribe(t,function(t){200===t.code?(s._im.isLogin=!0,e(t)):(i.session.clear(),console.log("subscribe fail",t))})):(i.session.clear(),console.log("login fail",t))}}var s=this,o={};window.sessionStorage&&(o=i.session.getItem("WKim_loginInfo"),o=JSON.parse(o));var c=n(t||function(){});!a.isEmpty(o)&&o.body.openId==e.openId&&o.body.accessToken?c(o):(e.deviceId||(e.deviceId=r.getDid()),s._OAuthI.alogin([e],c))},s.prototype.logout=function(){var e=this;i.session.setItem("WKim_loginInfo",null),e._im.ws.forceClose()},s.prototype.kick=function(e,t,n){var s=this,o=t,i=s._message.buildTextMessage(o);s._OAuthI.kick(e,i,n)},s.prototype.setNickName=function(e){var t=this;return t._im.nick=e,e},s.prototype.lastestAuthInfo=function(){return i.session.getItem("WKim_loginInfo")},s.prototype.refreshToken=function(e,t){this._OAuthI.refreshToken([e],function(e){200==e.code?t(e):console.log("refreshToken fail",e)})},s.prototype.isLogin=function(){var e=this;return e._im.isLogin||!1},s.prototype.coldLogin=function(e,t){var n=this;n._im.ws.sendMsg("/r/ColdBootI/login",{},e,!1,function(){200==res.code?t(res):console.log("coldLogin fail",res)})},t.exports=s},{"../../libs/storage/storage":19,"../../libs/tools/deviceId":22,"../../libs/tools/log":25,"../../libs/tools/method":27,"../net/entry":17}],2:[function(e,t,n){var s=e("../../libs/tools/method");t.exports=function(e,t,n){function o(e){if(e)return e.replace("/s/","");throw e}function i(e){var n=e.body.conversationId,s=e.body.messageId,i=t._data_messages[s];i&&(i.senderMessageStatus=i.senderMessageStatus||{},i.senderMessageStatus=e.body.status);var r=t._data_listConversations;r.forEach(function(i,r){var a=t._data_conversations[i];if(a&&a.baseConversation.conversationId==n&&a.lastMessages[0]&&a.lastMessages[0].baseMessage.messageId==s){var c=a.lastMessages[0];c.senderMessageStatus=c.senderMessageStatus||{},c.senderMessageStatus=e.body.status,t.conversation.trigger("conversationChanged",o(e.lwp),a,r)}}),t._data_msg[s]?t._data_msg[s].trigger("msgChanged",o(e.lwp),i):0,t._data_conv[n]?t._data_conv[n].trigger("msgChanged",o(e.lwp),i):0}function r(e,n){var s,i=e.body.messageId,r=e.body.conversationId,a=!1;t._data_messages[i]?(a=!0,s=t._data_messages[i]):s={baseMessage:{}};var c=!1;if(n)n.split(",").forEach(function(t){s.baseMessage[t]=e.body[t]}),t._data_msg[i]?t._data_msg[i].trigger("msgChanged",o(e.lwp),s):0,t._data_conv[r]?t._data_conv[r].trigger("msgChanged",o(e.lwp),s):0;else{if(s.baseMessage=e.body,2==s.baseMessage.content.contentType){var d=s.baseMessage.content.photoContent.mediaId;s.baseMessage.content.photoContent.mediaId=t.mediaId(d)}3==s.baseMessage.content.contentType}t._data_messages[i]=s,t._data_msg[i]?t._data_msg[i].trigger("msgCreated",s):0,t._data_conv[r]?t._data_conv[r].trigger("msgCreated",s):0,t._data_conv[r]?t._data_conv[r].unreadCount++:0;var u=t._data_listConversations;if(u.forEach(function(i,a){var d=t._data_conversations[i];i==r&&(c=!0),d&&d.baseConversation.conversationId==r&&(d.lastMessages[0]&&d.lastMessages[0].baseMessage&&n?n.split(",").forEach(function(e){d.lastMessages[0].baseMessage[e]=s.baseMessage[e]}):d.lastMessages[0]=s,t.conversation.trigger("conversationChanged",o(e.lwp),d,a))}),!c){u.splice(0,0,r),t._data_listConversations=u;var l=t.conversation;l._getConversation(r,function(e){t.conversation.trigger("conversationCreated",t._data_conversations[r],0);var n=t._data_conversations[r].lastMessages[0];n&&n.baseMessage.messageId!=i})}var f=t._data_conv[r];f&&-1==f.messages.indexOf(i)&&f.messages.push(i)}function a(e,n){var i=e.body.conversationId,r=t._data_listConversations,a=!1,c={};if(r.forEach(function(r,c){var d=t._data_conversations[r];r==i&&(a=!0),d&&d.baseConversation.conversationId==i&&(a=!0,n?n.split(",").forEach(function(t){d.baseConversation[t]=e.body[t]}):d.baseConversation=s.assign(d.baseConversation,e.body),t.conversation.trigger("conversationChanged",o(e.lwp),d,c))}),!a){if(n&&1==e.body.hide)return;r.splice(0,0,i),t._data_listConversations=r;var c=t.conversation;return void c._getConversation(i,function(e){t.conversation.trigger("conversationCreated",t._data_conversations[i],0)})}t._data_conv[i]?t._data_conv[i].trigger("conversationChanged",o(e.lwp),c):0}switch(e.lwp){case"/s/readstatus":var c=e.body.readStatusList;c.forEach(function(t){i({body:t,lwp:e.lwp})});break;case"/s/status":i(e);break;case"/s/msgTag":r(e,"tag,extension");break;case"/s/msgInfo":r(e,"extension");break;case"/s/msg":r(e);break;case"/s/convex":a(e);break;case"/s/conp":a(e,"sort,hide,notificationOff");break;case"/s/reconn":var d=e.body.messageList,u=e.body.readList,l=e.body.conversationList,f=e.body.messageTagList,g=e.body.conversationPrivateList,p=e.body.msgNoticeList;d.forEach(function(t){r({body:t,lwp:e.lwp})}),u.forEach(function(t){i({body:t,lwp:e.lwp})}),l.forEach(function(t){a({body:t,lwp:e.lwp})}),f.forEach(function(t){r({body:t,lwp:e.lwp},"memberTag")}),g.forEach(function(t){a({body:t,lwp:e.lwp},"sort,hide")}),p.forEach(function(t){r({body:t,lwp:e.lwp},"extension")});break;case"/s/delMsg":delete t._data_messages[e.body],t._data_msg[e.body].trigger("msgChanged","delMsg",e.body);break;default:t.onCustomTopic?t.onCustomTopic(e):0;break;case"/s/devSts":t.trigger("deviceChange",e.body);break;case"/push/kickout":t.trigger("kickout",e.body)}t.onBroadcast(o(e.lwp),e)}},{"../../libs/tools/method":27}],3:[function(e,t,n){function s(e){var t=this;this._im=e.im,this.conversation=e.conversation,this.conversationId=this.conversation.baseConversation.conversationId,this._message=t._im.message,this._conversation=t._im.conversation,this._IDLConversation=o["interface"].IDLConversation(t._im.ws),this._IDLMessage=o["interface"].IDLMessage(t._im.ws),this._IDLSend=o["interface"].IDLSend(t._im.ws),this.hide=!1,this.messages=[],this.unreadCount=0,1===this.conversation.baseConversation.type?t.isSingleChat=!0:t.isSingleChat=!1,r.assign(this,new c)}var o=e("../net/entry"),i=(e("../../libs/storage/storage"),e("../../libs/tools/log")),r=e("../../libs/tools/method"),a=e("../message/msg"),c=(e("../tools/deviceId"),e("../../libs/tools/event"));s.prototype.getTitle=function(){return this.isSingleChat?this.peerId():this.conversation.baseConversation.title},s.prototype.updateTitle=function(e,t){var n=this;if(!n.isSingleChat){var s=this.conversation.baseConversation.title,o=n._im.TEXT.editGroupName.replace("$original$",s).replace("$now$",e),i=n._message.buildTextMessage(o);n._IDLConversation.updateTitle([n.conversationId,e,i],function(s){200===s.code?(n.conversation.baseConversation.title=e,t&&t(s)):console.log("修改title失败")})}},s.prototype.updateIcon=function(e,t){var n=this;if(!n.isSingleChat){var s=n._message.buildTextMessage(n._im.TEXT.editGroupIcon);n._IDLConversation.updateIcon([n.conversationId,e,s],function(s){200===s.code?(n.conversation.baseConversation.icon=e,t&&t(s)):console.log("更新Icon失败")})}},s.prototype.remove=function(e){var t=this;t._IDLConversation.hide([t.conversationId],function(n){if(200===n.code){var s=t._im._data_listConversations.indexOf(t.conversationId);-1!==s&&t._im._data_listConversations.splice(s,1),delete t._im._data_conversations[t.conversationId],e&&e(n)}else console.log("remove fail")})},s.prototype.quit=function(e,t){var n=this;if(!n.isSingleChat){var s=n._message.buildTextMessage(n._im.TEXT.quitGroup);n._IDLConversation[t||"quit"]([n.conversationId,!1,s],function(t){if(200===t.code){message.buildTextMessage(n._im.TEXT.quitGroup);n.hide=!0,e&&e(t)}else console.log("quit fail")})}},s.prototype.quitSilent=function(e){this.quit(e,"quitSilent")},s.prototype.hideAndClear=function(e){var t=this;t._IDLConversation.hideAndClear([t.conversationId],function(n){200===n.code?(t.hide=!0,e&&e(n)):console.log("hide fail")})},s.prototype.listMessages=function(e,t,n){var s=this;e=e||9999999999999,t=t||20;var o=s._im._data_listMessages[s.conversationId]||[];if(o.length>0&&s.lastMessageCreatedAt()<e){var i=[];return o.forEach(function(e){i.push(s._im._data_messages[e])}),void(n&&n({code:200,body:i}))}s._IDLMessage.listMessages([s.conversationId,!1,e,t],function(e){if(200==e.code){e.body.sort(s._sort);var t=e.body.map(function(t,n){if(2==t.baseMessage.content.contentType){var o=t.baseMessage.content.photoContent.mediaId;t.baseMessage.content.photoContent.mediaId=s._im.mediaId(o)}return 3==t.baseMessage.content.contentType,s._im.data("messages",t),e.body[n]=t,t.baseMessage.messageId}),o=s._im._data_listMessages[s.conversationId]||[];o=r.uniqueMessages(o.concat(t)),s.messages=o,s._im.data("listMessages",o,s.conversationId),n&&n(e)}else console.log("list messages fail")})},s.prototype._sort=function(e,t){return e.baseMessage.createdAt-t.baseMessage.createdAt},s.prototype.listMembers=function(e,t,n){var s=this;if(e=e||0,t=t||100,"function"==typeof e&&(n=e,e=0,t=100),s.isSingleChat){var o=s.conversationId.split(":").map(function(e){return{openIdEx:{tag:0,openId:parseInt(e)},role:3}});return void(n&&n({code:200,body:o}))}if(s._listMembers){if(e>0&&t<s.listMembers.length)return void(n&&n({body:s._listMembers.slice(e,t),code:200}));e>0&&t>s.listMembers.length}s._IDLConversation.listMembers([s.conversationId,e,t],function(e){if(200==e.code){var t=s._im._data_listMembers[s.conversationId]||[];t=r.uniqueOpenId(t.concat(e.body)),s._im.data("listMembers",t,s.conversationId),s._listMembers=t,e.body=t,n&&n(e)}else console.log("fail")})},s.prototype.addMembers=function(e,t){var n=this;if(!n.isSingleChat){var s=n._im.TEXT.inviteJoin.replace("$whos$",e.join(",")),o=message.buildTextMessage(s);e=e.map(function(e){return parseInt(e)}),n._IDLConversation.addMembers([n.conversationId,e,o],function(e){if(200==e.code){var s=n._im._data_listMembers[n.conversationId]||[],o=e.body.map(function(e){return{openIdEx:{openId:e}}});s=r.uniqueOpenId(s.concat(o)),n._im.data("listMembers",s,n.conversationId),n._listMembers=s,e.body=s,t&&t(e)}else console.log("fail")})}},s.prototype.removeMembers=function(e,t){var n=this;if(!n.isSingleChat){var s=n._im.TEXT.kickout.replace("$whos$",e.join(",")),o=message.buildTextMessage(s);n._IDLConversation.removeMembers([n.conversationId,!0,e,o],function(s){if(200==s.code){var o=n._im._data_listMembers[n.conversationId]||[];o=o.filter(function(t){return!e.some(function(e){return t===e})}),n._im.data("listMembers",o,n.conversationId),n._listMembers=o,s.body=o,t&&t(s)}else console.log("fails")})}},s.prototype.updateTag=function(e,t){e.tag&&self._IDLConversation.updateTag([self.conversationId,e.tag],function(e){200===e?(self.conversation.baseConversation.tag=tag,t&&t()):console.log("fail")})},s.prototype.updateExtension=function(e,t){e.extension&&self._IDLConversation.updateExtension([self.conversationId,e.extension],function(e){200===e.code?t(e):console.log("fail")})},s.prototype.setTop=function(e,t){return"boolean"!=typeof e?void i.warn("setTop","need bool <boolean>"):void self._IDLConversation.setTop([self.conversationId,e],function(e){200===e.code?t&&t(e):console.log("fail")})},s.prototype.updateDraftMessage=function(e){var t=message.buildTextMessage(e);return this.drafMessage=t,e},s.prototype.getMsg=function(e){var t=this,n=t._im._data_messages[e];if(!n)return void console.warn("getMsg","is empty");if(n.baseMessage.conversationId!=t.conversationId)return void console.warn("getMsg","this messageId is not belong this conv");n.senderMessageStatus=n.senderMessageStatus||{};var s=t._im._data_msg[e];return s||(s=new a(t._im,n),t._im.data("msg",s,e)),s},s.prototype.sendMsg=function(e,t){var n=this,s={};s.conversationId=n.conversationId,s=r.assign(s,e),n._IDLSend.send([s],function(e){if(200===e.code){var o={baseMessage:{messageId:e.body.messageId,createdAt:e.body.createdAt,openIdEx:{openId:n._im.openId,tag:0},conversationId:n.conversationId},senderMessageStatus:e.body.model};o.baseMessage=r.assign(o.baseMessage,s),e.body=o,n._im.data("messages",o),-1==n.messages.indexOf(o.baseMessage.messageId)&&n.messages.push(o.baseMessage.messageId),t&&t(e)}else console.log("fail")})},s.prototype.lastMessageCreatedAt=function(){var e=this,t=e._im._data_listMessages[e.conversationId]||[],n=e._im._data_messages[t[t.length-1]];return n?n.baseMessage.createdAt:9999999999999},s.prototype.peerId=function(){var e=this;return e.isSingleChat?e._im.conversation.peerId(e.conversationId):!1},t.exports=s},{"../../libs/storage/storage":19,"../../libs/tools/event":24,"../../libs/tools/log":25,"../../libs/tools/method":27,"../message/msg":9,"../net/entry":17,"../tools/deviceId":22}],4:[function(e,t,n){function s(e){var t=this;this._im=e,this._IDLConversation=o["interface"].IDLConversation(t._im.ws),i.assign(this,new a)}var o=e("../net/entry"),i=(e("../../libs/storage/storage"),e("../../libs/tools/log"),e("../../libs/tools/method")),r=e("./conv"),a=e("../../libs/tools/event");s.prototype._getConversation=function(e,t){var n=this;if(t=t||function(){},i.isString(e))return n._im._data_conversations[e]?void setTimeout(function(){t({body:n._im._data_conversations[e],code:200})},1):void n._IDLConversation.getByIdUnlimited([e],function(e){200===e.code?e.body&&e.body.baseConversation?(n._im.data("conversation",e.body),t(e)):console.log("can not find this conversation"):t(e)});if(i.isArray(e)){var s=[],o=[];return e.forEach(function(e){n._im._data_conversations[e]?s.push(n._im._data_conversations[e]):o.push(e)}),void n._IDLConversation.getByIds([o],function(e){200===e.code?e.body&&e.body[0]&&e.body[0].baseConversation?(e.body.forEach(function(e){n._im.data("conversation",e),s.push(e)}),t(s)):console.log("getByIds(), can not find this conversation"):console.log("getByIds(), fail")})}console.log("_getConversation(), conversationId is a wrong format, <string> or <array> ")},s.prototype.create=function(e,t){var n=this;if(t=t||function(){},!e)throw"options is undefiend";if(!i.isObject(e))throw"options must be a object";i.isArray(e)&&(e={openIds:e}),e.openIds.forEach(function(e){if(!String(e).match(/[\d]+/))throw e+" is not a openId"}),e.openIds=e.openIds.concat([n._im.openId]);var s=[];e.openIds.forEach(function(e){-1==s.indexOf(e)&&s.push(e)}),e.openIds=s,e.openIds.forEach(function(t,n){e.openIds[n]=Number(t)}),e.openIds.sort(function(e,t){return e-t});var o=1,r="",a="";if(!(e.openIds.length>2)){a=e.openIds.join(":");var c={success:!0,body:a};return n._im._data_conversations[a]={baseConversation:{title:r,icon:r,conversationId:a},lastMessages:[]},void t(c)}o=2,r="uids:"+(e.openIds||[]).join(",");var d=n._im.message,u=n._im.TEXT.createGroupText,l=d.buildTextMessage({msg:u,creatorType:2});n._IDLConversation.create([{openIds:e.openIds||[],title:e.title||r,icon:e.icon||r,tag:e.tag||0,extension:e.extension,type:o},l],function(e){200===e.code?n._im._data_conversations[e.body]={baseConversation:{conversationId:e.body},lastMessages:[]}:console.log("fail"),t(e)})},s.prototype.list=function(e,t){var n=this;if("function"!=typeof t)throw"callback must be a function";t=t||function(){};if(!i.isArray(e))throw"param one must be array";var s=function(e,s){if(n._im._data_listConversations.length>0){var o=[];return n._im._data_listConversations.forEach(function(e){o.push(n._im._data_conversations[e])}),void setTimeout(function(){t({memory:!0,success:!0,body:o})},1)}n._IDLConversation.listConversations([e,s],function(e){if(200===e.code){if(e.body&&e.body[0]&&e.body[0].baseConversation){var s=[];e.body.sort(function(e,t){var n,s;return n=e.lastMessages&&e.lastMessages[0]?e.lastMessages[0].baseMessage.createdAt:e.baseConversation.createAt,s=t.lastMessages&&t.lastMessages[0]?t.lastMessages[0].baseMessage.createdAt:t.baseConversation.createAt,s-n}),e.body.forEach(function(e){var t=e.baseConversation.conversationId;n._im._data_conversations[t]=e,s.push(t)}),n._im._data_listConversations=s,n._im._data_convList.listConversations=n._im._data_listConversations}}else console.log("fail");t(e)})};s(e[0],e[1])},s.prototype.get=function(e,t){var n=this;if(!String(e).match(/[\d:]+/))throw"id is not a conversationId";return e=String(e),n._im._data_conv[e]?void(t&&t.call(n._im._data_conv[e],n._im._data_conv[e])):void this._getConversation(e,function(s){200==s.code?(n._im._data_conv[e]=new r({im:n._im,conversation:s.body}),t&&t.call(n._im._data_conv[e],n._im._data_conv[e])):console.log("fail")})},s.prototype.removes=function(e,t){var n=this;n._IDLConversation.hides([e],function(s){200==s.code?(e.forEach(function(e){delete n._im._data_conversations[e],n._im._data_listConversations[0]&&n._im._data_listConversations.splice(n._im._data_listConversations.indexOf(e),1)}),t&&t(s)):console.log("fail")})},s.prototype.unreadCount=function(){var e=0;return self._im._data_listConversations.forEach(function(t){var n=self._im._data_conversations[t].lastMessages[0];2!=n.receiverMessageStatus.readStatus&&e++}),e},s.prototype.peerId=function(e){var t=this;if(!e)throw"need conversationId";if(-1==e.indexOf(":"))throw"need single chat conversationId";return e.split(":").filter(function(e){return e!==t._im.openId.toString()})[0]},t.exports=s},{"../../libs/storage/storage":19,"../../libs/tools/event":24,"../../libs/tools/log":25,"../../libs/tools/method":27,"../net/entry":17,"./conv":3}],5:[function(e,t,n){"use strict";t.exports=window.WebSocket},{}],6:[function(e,t,n){"use strict";function s(e,t,n){this.name=e;var n=n||{};if($.extend(this,u,n),!t||!t.appKey)return void r.warn("*请设置 appKey ");this.appKey=t.appKey,this.userForceClose=!1,this._loginStateChecker=null,this.offlineTime=0,this._timeoutTimer=0,this._pingCheckTimer=0,this._regTimeout=0,this._isReconnecting=!1,this._reconnInterval=0,this.msgCallbacks={},this.msgQueue=[],this._setState("CLOSED"),this.conf=t;var s=this;l&&(window.addEventListener("offline",function(e){s.forceReconnect(),r.info("network offline")}),window.addEventListener("online",function(e){s.offlineTime=0,s.forceReconnect(),r.info("network online")}))}var o=e("./WebSocket"),i=e("../tools/deviceId"),r=e("../tools/log"),a=e("../tools/method"),c="wss://wswukong.laiwang.com/lwp",d=0,u={onDownMsg:function(){},onReged:function(){},onStateChange:function(){}},l=!1;window.navigator.hasOwnProperty("onLine")&&(l=!0),s.prototype={_setState:function(e){this.state=e,this.onStateChange(this.state)},_onOpen:function(){var e=this;e.offlineTime=0,clearInterval(e._reconnInterval),this._isReconnecting=!1,e._setState("OPEN"),r.info("websocket open"),this._reg(function(t){t===!0?(e.onReged(),e._setState("REGED")):e.forceReconnect()})},_onMessage:function(e){var t=this;clearTimeout(this._timeoutTimer),clearTimeout(this._pingCheckTimer),this._timeoutTimer=setTimeout(function(){t._pingCheckTimer=setTimeout(function(){t.forceReconnect(),r.info(t.name+": 20s 未收到消息，强制ping检查10s无返回，强制断线")},1e4),t._ping(function(e){clearTimeout(t._pingCheckTimer)})},2e4);try{var n=JSON.parse(e.data)}catch(s){return console.log(e),void console.log("parse json error :"+e.data)}window.debug===!0&&console.log("receive :"+e.data);var o=n.headers.mid.split(" ")[0];if(n.lwp){console.log(n);var i=function(e,s,o,i){t.responseMsg(e,n.headers.mid)};i("/s/msg"==n.lwp?{updateStatus:!1}:{}),this.onDownMsg(n)}else o&&this.msgCallbacks[o]&&(this.msgCallbacks[o][0]&&this.msgCallbacks[o][0](n),delete this.msgCallbacks[o])},_onClose:function(){var e=this;this._setState("CLOSED"),this.offlineTime++,this.reconnect();var t={headers:{},code:408,body:{}};Object.keys(this.msgCallbacks).forEach(function(n){var s=e.msgCallbacks[n]&&e.msgCallbacks[n][0]&&e.msgCallbacks[n][0];delete e.msgCallbacks[n],s&&s(t)}),this._unbindHandle()},_reg:function(e){var t=this,n=i.getDid();clearTimeout(t._regTimeout);var s=this.sendMsg("/reg",{"cache-header":"token app-key did ua vhost",vhost:"WK",ua:t.conf.ua||window.navigator.userAgent,did:n,"app-key":t.appKey},null,!1,function(n){clearTimeout(t._regTimeout),200===n.code?(r.info("reg success"),e&&e(!0)):(r.info("reg fail"),e&&e(!1,n))}),o=s[2]||-1;this._regTimeout=setTimeout(function(){delete t.msgCallbacks[o],e&&e(!1,{body:{reason:"timeout"},code:408})},1e4)},connect:function(){this.userForceClose=!1,this._connect()},reconnect:function(){if(this.userForceClose)return!1;if(this._isReconnecting!==!0){this._isReconnecting=!0;var e=this,t=0;this._reconnInterval=setInterval(function(){t>3&&(e.forceReconnect(),t=0),e._connect()||(t+=1)},5e3)}},forceReconnect:function(){this.ws&&(this.ws.onclose(),this._unbindHandle(),this.ws&&this.ws.close()),this.ws=null},_connect:function(){return this.userForceClose?!1:this.ws&&this.ws.readyState<2?!1:(this.ws=new o(this.conf.WSURL||c),this._setState("CONNECTING"),this._bindHandle(),!0)},_bindHandle:function(){this.ws?(this.ws.onopen=$.proxy(this._onOpen,this),this.ws.onmessage=$.proxy(this._onMessage,this),this.ws.onclose=$.proxy(this._onClose,this)):r.info("ws is null when bind handle")},_unbindHandle:function(){this.ws&&(this.ws.onopen=function(){},this.ws.onmessage=function(){},this.ws.onclose=function(){})},_ping:function(e){this.sendMsg("/ping",{},null,!1,function(t){e&&e(t)})},sendMsg:function(e,t,n,s,o){var s=s||!1,i=d++,t=t||{};t.mid=i+" 0",t["x-event-id"]=a.getUUID();var r={lwp:e,headers:t,body:n};return this._send(r,s,o)},responseMsg:function(e,t,n,s){console.log("回执");var s=s||{};s.mid=t;var n=n||200,o={code:n,headers:s,body:e};return this._send(o,!0,null)},_send:function(e,t,n){if(!this.ws||1!==this.ws.readyState)return t?(this.msgQueue.push([e,t,n]),[!1,"cached"]):[!1,"uncache"];try{if(window.debug===!0&&console.log("send: "+JSON.stringify(e)),this.ws.send(JSON.stringify(e)),n){var s=e.headers.mid.split(" ")[0];this.msgCallbacks[s]=[n]}return[!0,null,s]}catch(o){return[!1,o]}},forceClose:function(){this.userForceClose=!0,this._setState("CLOSING"),this.ws&&this.ws.close(),clearTimeout(this._timeoutTimer),clearTimeout(this._pingCheckTimer),clearTimeout(this._loginStateChecker),clearTimeout(this._regTimeout)},flushMsgs:function(){for(;this.msgQueue.length>0;){var e=this.msgQueue.shift();this._send.apply(this,e)}}},t.exports=s},{"../tools/deviceId":22,"../tools/log":25,"../tools/method":27,"./WebSocket":5}],7:[function(e,t,n){!function(n){"use strict";function s(e,t){var n=this;return this.version="0.0.1",this.env=e.env||"online",this.net=i,this.tool=d,this.ua=e.ua,this.log=a,e.appKey?(this.appKey=e.appKey,this.reged=!1,this._data_conversations={},this._data_listConversations=[],this._data_listMessages={},this._data_messages={},this._data_listMembers={},this._data_userProfiles={},this._data_conv={},this._data_msg={},this._data_convList={onChange:function(){}},this.TEXT=d.assign({createGroupText:" 发起了群聊",createChatText:"",quitGroup:" 已经退出群聊",inviteJoin:" 邀请 $whos$ 加入群聊",kickout:" 将 $whos$ 移出了群聊",editGroupName:' 把群 "$original$" 修改为 "$now$" ',editGroupIcon:" 修改了群头像",nickName:""},e.TEXT),this.parseBroadcast=v,this.onBroadcast=e.onBroadcast||function(){},this.onStateChange=e.onStateChange||function(){},this.mediaId=m,this.aladin(this.appKey,function(s){n.WSURL=s,n.ws=new o("im",{appKey:n.appKey,WSURL:s,ua:n.ua},{onReged:function(){n.reged=!0,t&&t.call(n)},onStateChange:function(e){},onDownMsg:function(e,t){n.parseBroadcast(e,n,t)}}),n.ws.connect(),e.mockReg?e.mockReg():0,n.auth=new l(n),n.conversation=new f(n),n.message=new g(n),n.user=new p(n),n.sync=new h(n),n.upload=new y(n)}),this.isMessageMeSend=function(e){return e.baseMessage.openIdEx.openId==this.openId?!0:!1},this.setNickName=function(e){return this.TEXT.nickName=e,!0},void d.assign(this,new b)):void a.warn("需要appKey")}var o=e("../libs/io/ws"),i=e("../libs/net/entry"),r=e("../libs/storage/storage"),a=e("../libs/tools/log"),c=e("../libs/tools/deviceId"),d=(e("../libs/tools/es5"),e("../libs/tools/method")),u=e("jsonp"),l=e("../libs/auth/auth"),f=e("../libs/conversation/conversation"),g=e("../libs/message/message"),p=e("../libs/user/user"),m=e("./tools/mediaId"),v=e("./broadcast/broadcast"),h=e("../libs/sync/sync.js"),y=e("../libs/upload/upload"),b=e("../libs/tools/event");s.prototype.aladin=function(e,t){u("http://vip.laiwang.com/alfa?sdkver="+this.version+"&os=web&net=wifi&appkey="+e+"&env="+this.env,{},function(n,s){s.domainList&&s.domainList[0]&&s.domainList[0].ipList&&s.domainList[0].ipList[0]?t(s.domainList[0].ipList[0]):(t(null),a.error("aladin",s,e))})},s.prototype.data=function(e,t,n){switch(e){case"messages":var n=t.baseMessage.messageId;if(!n)return;this._data_messages[n]=t;break;case"conversation":var n=t.baseConversation.conversationId;this._data_conversations[n]=t;break;case"listConversation":this._data_listConversations=t;break;case"conv":var n=t.conversationId;this._data_conv[n]=t;break;case"msg":var n=n;this._data_msg[n]=t;break;case"listMessages":var n=n;this._data_listMessages[n]=t;break;case"listMembers":var n=n;this._data_listMembers[n]=t}},s.prototype.subscribe=function(e,t,n){function s(e,n){o.ws.sendMsg("/subscribe",{"app-key":o.appKey,token:e},null,!1,function(e){if(200==e.code)e.success=!0;else if(e.success=!1,401==e.code){if(n)return console.warn("token 过期"),void t(e);o.auth.refreshToken({deviceId:c.getDid(),appKey:o.appKey,refreshToken:d},function(e){200==e.code?(r.session.setItem("WKim_loginInfo",JSON.stringify(e)),s(e.body.accessToken,"again")):a.error("refreshToken",e)})}t(e)})}var o=this;this.openId=e.body.openId;var i=e.body.accessToken,d=e.body.refreshToken;s(i)},"function"==typeof define?define(function(){return s}):window.WKim=s;try{t&&(t.exports=s)}catch(M){}}(window)},{"../libs/auth/auth":1,"../libs/conversation/conversation":4,"../libs/io/ws":6,"../libs/message/message":8,"../libs/net/entry":17,"../libs/storage/storage":19,"../libs/sync/sync.js":20,"../libs/tools/deviceId":22,"../libs/tools/es5":23,"../libs/tools/event":24,"../libs/tools/log":25,"../libs/tools/method":27,"../libs/upload/upload":28,"../libs/user/user":29,"./broadcast/broadcast":2,"./tools/mediaId":26,jsonp:30}],8:[function(e,t,n){function s(e){this._im=e,this._IDLSend=o["interface"].IDLSend(e.ws),this._IDLMessage=o["interface"].IDLMessage(e.ws),this._IDLMessageStatus=o["interface"].IDLMessageStatus(e.ws)}var o=e("../net/entry"),i=(e("../../libs/storage/storage"),e("../../libs/tools/log")),r=(e("../tools/deviceId"),e("../../libs/tools/method"));s.prototype.buildTextMessage=function(e){var t=this;if(!e)throw"buildTextMessage need options => {msg:'like hello world'}";if("string"==typeof e)var e={msg:e};return{creatorType:e.creatorType||1,type:e.type||1,tag:e.tag||0,uuid:r.getUUID(),content:{contentType:1,textContent:{text:String(e.msg)||""}},nickName:t._im.TEXT.nickName}},s.prototype.buildImageMessage=function(e){var t=this;return e.mediaId?(e.photoSize||i.warn("buildImageMessage","need options.photoSize <number>"),{creatorType:e.creatorType||1,type:e.type||1,tag:e.tag||0,uuid:r.getUUID(),content:{contentType:2,photoContent:{mediaId:e.mediaId,picSize:e.photoSize||1e3}},nickName:t._im.TEXT.nickName}):void i.warn("buildImageMessage","need options.mediaId <string>")},s.prototype.buildAudioMessage=function(e){var t=this;return e.mediaId?{creatorType:e.creatorType||1,type:e.type||1,tag:e.tag||0,uuid:r.getUUID(),content:{contentType:3,photoContent:{mediaId:e.mediaId,duration:e.duration,audioVolumns:e.audioVolumns||[]}},nickName:t._im.TEXT.nickName}:void i.warn("buildAudioMessage","need options.mediaId <string>")},s.prototype.read=function(e,t){var n=this;if(t=t||function(){},0!=e.length){var s=[];e.forEach(function(e,t){var o=n._im._data_messages[e].receiverMessageStatus;(!o||o&&2!==o.readStatus)&&s.push(e)}),s.length>0?n._IDLMessageStatus.updateToRead([s],function(e){200==e.code?(s.forEach(function(e){n._im._data_messages[e].receiverMessageStatus={readStatus:2}}),t(e)):i.error("updateToRead",s,e)}):t({code:200})}},t.exports=s},{"../../libs/storage/storage":19,"../../libs/tools/log":25,"../../libs/tools/method":27,"../net/entry":17,"../tools/deviceId":22}],9:[function(e,t,n){function s(e,t){var n=this;this._im=e,this.message=t,this.messageId=t.baseMessage.messageId,this._IDLMessage=o["interface"].IDLMessage(n._im.ws),r.assign(this,new a)}var o=e("../net/entry"),i=(e("../../libs/storage/storage"),e("../../libs/tools/log")),r=e("../../libs/tools/method"),a=e("../../libs/tools/event");s.prototype.isAllReceiversRead=function(){return 0==msg.senderMessageStatus.unReadCount},s.prototype.isAt=function(){return r.has(msg,"@")},s.prototype.messageReceivers=function(e,t){var n=this;e&&r.isArray(e)||(i.warn("messageReceivers","need openIds <array>"),e=[]),n._IDLMessage.listMemberStatusByMessageId([e,messageId],function(e){200==e.code?t&&t(e):console.log("fail")})},s.prototype.unReadCount=function(){return this.message.senderMessageStatus.unReadCount},s.prototype.receiverCount=function(){return this.message.senderMessageStatus.totalCount},s.prototype.iHaveRead=function(){return 2==this.receiverMessageStatus.readStatus},s.prototype.updateExtension=function(e,t){var n=this;_wrapCallback(n,t);e=e||{},n._IDLMessage.updateExtension([e.tag,e.extension],function(e){200==e.code?t&&t(e):console.log("fail")})},s.prototype.remove=function(e){var t=this;t._IDLMessage.remove([t.messageId],function(t){200==t.code?e&&e(t):console.log("fail")})},s.prototype.isMe=function(){var e=this;return this.message.baseMessage.openIdEx.openId==e._im.openId?!0:!1},t.exports=s},{"../../libs/storage/storage":19,"../../libs/tools/event":24,"../../libs/tools/log":25,"../../libs/tools/method":27,"../net/entry":17}],10:[function(e,t,n){"use strict";function s(e){var t="IDLConversation",n=[[["Array","ConversationModel"],"listNewest",[["Number","count"]]],[["Array","ConversationModel"],"listConversations",[["Number","cursor"],["Number","count"]]],[["Array","ConversationModel"],"listGroup",[["Number","cursor"],["Number","count"]]],["ConversationModel","getById",[["string","conversationId"]]],["ConversationModel","getByIdUnlimited",[["string","conversationId"]]],["string","create",[["CreateConversationModel","model"],["SendMessageModel","messageModel"]]],["void","hide",[["string","conversationId"]]],[["Array","MemberRoleModel"],"listMembers",[["string","conversationId"],["Number","offset"],["Number","count"]]],[["Array","Number"],"addMembers",[["string","conversationId"],[["Array","Number"],"openIds"],["SendMessageModel","messageModel"]]],[["Array","Number"],"removeMembers",[["string","conversationId"],[["Array","Number"],"openIds"],["boolean","isCleanUp"],["SendMessageModel","messageModel"]]],["void","updateTitle",[["string","conversationId"],["String","newTitle"],["SendMessageModel","messageModel"]]],["void","updateIcon",[["string","conversationId"],["String","newIcon"],["SendMessageModel","messageModel"]]],["void","updateTag",[["string","conversationId"],["Number","tag"]]],["void","updateExtension",[["string","conversationId"],[["Object","string","string"],"extension"]]],["void","updateMemberExtension",[["string","conversationId"],[["Array","Number"],"openIds"],[["Object","string","string"],"extension"]]],["void","quit",[["string","conversationId"],["boolean","isCleanUp"],["SendMessageModel","messageModel"]]],["void","quitSilent",[["string","conversationId"],["boolean","isCleanUp"],["SendMessageModel","messageModel"]]],["void","updateNotificationOff",[["string","conversationId"],["Number","status"]]],["void","hides",[[["Array","string"],"conversationIds"]]],["void","updateInfo",[["ConversationInfoModel","model"]]],["Number","setTop",[["String","cid"],["boolean","toTop"]]],["void","updateStatus",[[["Array","string"],"conversationIds"],["Number","status"]]],[["Array","ConversationModel"],"getByIds",[[["Array","string"],"conversationIds"]]],["void","quits",[[["Array","string"],"conversationId"]]],["void","disband",[["string","conversationId"]]],[["Array","MemberRoleModel"],"listRoles",[["string","conversationId"],[["Array","Number"],"openIds"]]],[["Array","ConversationModel"],"listGroupByTags",[[["Array","Number"],"tags"]]],["CodeModel","getCode",[["string","conversationId"]]],["ConversationCardModel","verifyCode",[["string","code"]]],["void","hideAndClear",[["string","conversationId"]]],[["Array","CommonConversationModel"],"getCommonByIds",[[["Array","string"],"conversationIds"]]],["void","updateOwner",[["string","conversationId"],["Number","openId"],["SendMessageModel","messageModel"]]],["void","updateNotificationSound",[["string","conversationId"],["string","sound"]]],["void","updateAuthority",[["string","conversationId"],["Number","authority"]]]],s={};
return n.forEach(function(n){var o=n[1];s[o]=function(n,s){e.sendMsg("/r/"+t+"/"+o,{},n,!1,s)}}),s}t.exports=s},{}],11:[function(e,t,n){"use strict";function s(e){var t="IDLMessage",n=[[["Array","MessageModel"],"listMessages",[["string","conversationId"],["boolean","forward"],["Number","cursor"],["Number","count"]]],[["Array","UnReadMemberModel"],"listUnreadMembers",[["Number","messageId"]]],["void","remove",[["Number","messageId"]]],["MessageModel","getMessageById",[["Number","messageId"]]],["void","updateMemberTag",[[["Array","Number"],"openIds"],["Number","messageId"],["Number","tag"]]],["void","updateMemberExtension",[[["Array","Number"],"openIds"],["Number","messageId"],[["Object","string","string"],"extension"]]],[["Array","MemberMessageStatusModel"],"listMemberStatusByMessageId",[[["Array","Number"],"openIds"],["Number","messageId"]]],["void","removes",[[["Array","Number"],"messageIds"]]],["void","updateMemberTagAndExt",[[["Array","Number"],"openIds"],["Number","messageId"],["Number","tag"],[["Object","string","string"],"extension"]]],[["Array","Number"],"listTopUsers",[["Number","start"],["Number","end"],["Number","count"]]],["void","updateExtension",[["Number","messageId"],[["Object","string","string"],"extension"]]]],s={};return n.forEach(function(n){var o=n[1];s[o]=function(n,s){e.sendMsg("/r/"+t+"/"+o,{},n,!1,s)}}),s}t.exports=s},{}],12:[function(e,t,n){"use strict";function s(e){var t="IDLMessageStatus",n=[["void","updateToRead",[[["Array","Number"],"messageIds"]]]],s={};return n.forEach(function(n){var o=n[1];s[o]=function(n,s){e.sendMsg("/r/"+t+"/"+o,{},n,!1,s)}}),s}t.exports=s},{}],13:[function(e,t,n){"use strict";function s(e){var t="IDLSend",n=[["SendResultModel","send",[["SendMessageModel","messageModel"]]],["SendResultModel","forward",[["ForwardMessageModel","forwardModel"]]]],s={};return n.forEach(function(n){var o=n[1];s[o]=function(n,s){e.sendMsg("/r/"+t+"/"+o,{},n,!1,s)}}),s}t.exports=s},{}],14:[function(e,t,n){"use strict";function s(e){var t="OAuthI",n=[["OAuthModel","login",[["LoginModel","loginModel"]]],["OAuthModel","loginWithToken",[["TokenLoginModel","loginModel"]]],["OAuthModel","alogin",[["AdvancedLoginModel","loginModel"]]],["OAuthModel","refreshToken",[["RefreshTokenModel","refreshTokenModel"]]],["void","sendLoginSms",[["SmsRequestModel","smsRequestModel"]]],["OAuthModel","loginBySms",[["SmsRequestModel","smsRequestModel"]]],["void","kick",[["Number","deviceType"],["string","msg"]]]],s={};return n.forEach(function(n){var o=n[1];s[o]=function(n,s){e.sendMsg("/r/"+t+"/"+o,{},n,!1,s)}}),s}t.exports=s},{}],15:[function(e,t,n){"use strict";function s(e){var t="Sync",n=[["SyncPushPackageModel","getDiff",[["SyncInfoModel","syncInfo"]]],["SyncInfoModel","getState",[["SyncInfoModel","syncInfo"]]],["void","ackDiff",[["SyncInfoModel","syncInfo"]]]],s={};return n.forEach(function(n){var o=n[1];s[o]=function(n,s){e.sendMsg("/r/"+t+"/"+o,{},n,!1,s)}}),s}t.exports=s},{}],16:[function(e,t,n){"use strict";function s(e){var t="UserI",n=[["ProfileModel","getUserProfileByOpenId",[["Number","openId"]]],["ProfileModel","getUserProfileByMobile",[["string","mobile"]]],[["Array","ProfileModel"],"getUserProfilesByOpenIds",[[["Array","Number"],"oids"]]],[["Array","ProfileModel"],"getUserProfilesByMobiles",[["string","appKey"],[["Array","string"],"mobiles"],["boolean","isCreateNew"]]],["void","updateUserProfile",[["ProfileModel","userProfile"]]]],s={};return n.forEach(function(n){var o=n[1];s[o]=function(n,s){e.sendMsg("/r/"+t+"/"+o,{},n,!1,s)}}),s}t.exports=s},{}],17:[function(e,t,n){"use strict";var s=e("./keyPaddingGen");n["interface"]={},n.model={},n["interface"].IDLConversation=e("./dist/IDLConversation"),n["interface"].IDLMessage=e("./dist/IDLMessage"),n["interface"].IDLMessageStatus=e("./dist/IDLMessageStatus"),n["interface"].IDLSend=e("./dist/IDLSend"),n["interface"].Sync=e("./dist/Sync"),n["interface"].UserI=e("./dist/UserI"),n["interface"].OAuthI=e("./dist/OAuthI"),n.model.sync=s({SyncInfoModel:{def:{pts:["1","int","pts","// * 同步点"],seq:["2","int","seq","// * 同步序列号"],timestamp:["3","int","timestamp","// * 同步时间戳"]},COMMENT:"// 同步三元组, 客户端reg的时候带上 seq和pts, timestamp"},SyncPushModel:{def:{syncPushPackage:["1","SyncPushPackageModel","syncPushPackage","// * push的数据"],syncExtraType:["2","SyncExtraTypeModel","syncExtraType","// * tooLong tooLong2"]},COMMENT:"//服务端下行接口, push topic:  /s/sync  推下行数据包"},SyncPushPackageModel:{def:{startSeq:["1","int","startSeq","// * 起始seq"],endSeq:["2","int","endSeq","// * 结束seq"],timestamp:["3","int","timestamp","// * 上一次同步时间点"],maxPts:["4","int","maxPts","// * 该数据包中包含的最大pts"],hasMore:["5","boolean","hasMore","// * hasMore=true表示还有数据，客户端后续需要继续拉取数据"],data:["6",["Array","SyncDataModel"],"data"]},COMMENT:"//服务端下行接口, push topic:  /s/sync  推下行数据包"},SyncDataModel:{def:{objectType:["1","int","objectType","// * 数据包model类型，用于解码"],data:["2","byte[]","data","// * 同步数据"]},COMMENT:"//服务端下行接口, push topic:  /s/sync  推下行数据包"},SyncExtraTypeModel:{def:{type:["1","int","type","// * type=1 TooLong、 type=2 TooLong2"]},COMMENT:"//服务端下行接口, push topic:  /s/sync  推下行数据包"}}),n.model.im=s({SendMessageModel:{def:{uuid:["1","string","uuid","// * 客户端生成的id，绑定一个独立会话\r"],conversationId:["2","string","conversationId","// * 会话id\r"],type:["3","int","type","// * 默认为1-普通消息, 2-阅后即焚（暂时不启用）, 3-静默消息（该类消息不修改会话lastModify）\r"],creatorType:["4","int","creatorType","// * 消息创建者类型 1-SELF：表示用户自身产生消息 2-SYSTEM：表示系统自动生成消息 固定1\r"],content:["5","ContentModel","content","// * 附件(文本、图片，语音，文件或者组合类型等)\r"],tag:["6","int","tag","// * 业务自定义\r"],extension:["7",["Object","string","string"],"extension","// * msg扩展信息，业务自定义\r"],nickName:["8","string","nickName","// * 用户昵称\r"],receivers:["9",["Array","int"],"receivers","// * 接收者openId列表\r"],xpnModel:["10","XpnPushModel","xpnModel","// 服务端model。客户端请忽略\r"]},COMMENT:"// 消息发送对象\r"},ForwardMessageModel:{def:{uuid:["1","string","uuid","// * 客户端生成的id，绑定一个独立会话\r"],messageId:["2","int","messageId","// * 转发的消息id\r"],toConversationId:["3","string","toConversationId","// * 转发的目标会话id\r"],nickName:["4","string","nickName","// * 用户昵称\r"],xpnModel:["5","XpnPushModel","xpnModel","// * xpn推送控制模型\r"]},COMMENT:"// 消息转发对象\r"},BaseMessageModel:{def:{messageId:["1","int","messageId","// * 消息id\r"],conversationId:["2","string","conversationId","// * 会话id\r"],openIdEx:["3","OpenIdExModel","openIdEx","// * openId和tag\r"],type:["4","int","type","// * 默认为1-普通消息, 2-阅后即焚\r"],creatorType:["5","int","creatorType","// * 消息创建者类型 1-SELF：表示用户自身产生消息 2-SYSTEM：表示系统自动生成消息\r"],createdAt:["6","int","createdAt","// * 消息的创建时间，单位：毫秒\r"],content:["7","ContentModel","content","// * 附件(文本、图片，语音等)\r"],tag:["8","int","tag","// * 业务自定义\r"],extension:["9",["Object","string","string"],"extension","// * msg扩展信息，业务自定义\r"],memberTag:["10","int","memberTag","// * 业务扩展，只影响当前用户的属性\r"],memberExtension:["11",["Object","string","string"],"memberExtension","// * msgInbox扩展信息，业务自定义，只影响当前用户的属性\r"]},COMMENT:"// 基础的消息对象， 对应下行push topic：/s/msg\r"},MessageModel:{def:{baseMessage:["1","BaseMessageModel","baseMessage","// * 基础消息对象\r"],receiverMessageStatus:["2","ReceiverMessageStatusModel","receiverMessageStatus","// * 针对接收者的消息状态，已读和未读\r"],senderMessageStatus:["3","SenderMessageStatusModel","senderMessageStatus","// * 针对发送者的消息状态，未读人数和总人数\r"]},COMMENT:"// 带状态的消息对象\r"},ReceiverMessageStatusModel:{def:{readStatus:["1","int","readStatus","// * 接收者 是否已读这个消息 2-已读，其他-未读\r"]},COMMENT:"// 针对接收者的消息状态\r"},SenderMessageStatusModel:{def:{unReadCount:["1","int","unReadCount","// * 这条消息还有多少人未读\r"],totalCount:["2","int","totalCount","// * 消息发送到的总人数\r"]},COMMENT:"// 针对发送者的消息状态\r"},ContentModel:{def:{contentType:["1","int","contentType","// 其余组合类型使用attachments字段，contentType限制使用100以上\r"],textContent:["2","TextContentModel","textContent","// * 文本对象\r"],photoContent:["3","PhotoContentModel","photoContent","// * 图片对象\r"],audioContent:["4","AudioContentModel","audioContent","// * 语音对象\r"],fileContent:["5","FileContentModel","fileContent","// * 普通文件对象\r"],extension:["6",["Object","string","string"],"extension","// * @Deprecated\r"],attachments:["7",["Array","AttachmentModel"],"attachments","// * 组合类型字段\r"],atOpenIds:["8",["Object","string","string"],"atOpenIds","// * @功能的openId列表，key是openId（服务端不支持long类型），value是nick,\r"]},COMMENT:"// 发送的消息内容\r"},TextContentModel:{def:{text:["1","string","text","// * 文本内容\r"],templateId:["2","string","templateId","// * 系统消息模板ID\r"],templateData:["3",["Array","string"],"templateData","// * 系统消息模板数据列表\r"]},COMMENT:"// 文本消息\r"},PhotoContentModel:{def:{mediaId:["1","string","mediaId","// * mediaId\r"],picSize:["2","int","picSize","// * 原始图片大小\r"],type:["3","int","type","// * 图片类型，自定义\r"],picBytes:["4","byte[]","picBytes","// * 缩略图数据，需要控制数据大小, 只是下行使用\r"],fileType:["5","int","fileType","// * 图片类型 1-webp, 2-png, 3-jpg, 4-gif, 目前只有webp，只是下行使用\r"],orientation:["6","int","orientation","// * 图片方向，1-normal, 2-flip_horizontal, 3-rotate_180, 4-flip_vertical, 5-transpose, 6-rotate_90, 7-transverse, 8-rotate_270\r"]},COMMENT:"// 文本消息\r"},AudioContentModel:{def:{mediaId:["1","string","mediaId","// * mediaId\r"],duration:["2","int","duration","// * 语音时常\r"],audioVolumns:["3",["Array","int"],"audioVolumns","// * 语音波形\r"],audioBytes:["4","byte[]","audioBytes","// * 语音数据，需要控制数据大小, 只是下行使用\r"]},COMMENT:"// 文本消息\r"},FileContentModel:{def:{mediaId:["1","string","mediaId","// * mediaId\r"],fileName:["2","string","fileName","// * 文件名\r"],fileType:["3","string","fileType","// * 文件类型，取文件后缀\r"],fileSize:["4","int","fileSize","// * 文件大小\r"]},COMMENT:"// 文本消息\r"},OpenIdExModel:{def:{openId:["1","int","openId","// * 信息发送者id\r"],tag:["2","int","tag","// * 信息发送者的更新相关\r"]},COMMENT:"// openID扩展对象\r"},MemberRoleModel:{def:{openIdEx:["1","OpenIdExModel","openIdEx"],role:["2","int","role","// *1 群主，2管理员(现不用)，3普通用户\r"]},COMMENT:"// openID扩展对象\r"},UnReadMemberModel:{def:{openIdEx:["1","OpenIdExModel","openIdEx","// * openId和tag\r"],status:["2","int","status","// 0-未送达，1-已送达，未读，2-已送达，已读\r"]},COMMENT:"// 未读成员对象\r"},MemberMessageStatusModel:{def:{openIdEx:["1","OpenIdExModel","openIdEx","// * openId和tag\r"],status:["2","int","status","// 消息是否已读状态，2-已读，其他 未读\r"],reachStatus:["3","int","reachStatus","// 消息是否已送达，0和1、未达，2、已达\r"]},COMMENT:"//成员消息对象--暂时与 UnReadMemberModel有重复\r"},SendResultModel:{def:{messageId:["1","int","messageId","// * 消息id\r"],createdAt:["2","int","createdAt","// * 消息创建时间，服务端时间\r"],model:["3","SenderMessageStatusModel","model","// 未读人数\r"]},COMMENT:"// 消息发送结果对象（包括转发）\r"},CreateConversationModel:{def:{openIds:["1",["Array","int"],"openIds","// * 会话成员列表\r"],title:["2","string","title","// * 会话的标题\r"],icon:["3","string","icon","// * 会话显示的图片地址信息\r"],extension:["4",["Object","string","string"],"extension","// * 扩展字段\r"],tag:["5","int","tag","// * 业务tag\r"],type:["6","int","type","// * 会话类型：1单聊，2群聊\r"]},COMMENT:"// 创建会话对象\r"},CommonConversationModel:{def:{conversationId:["1","string","conversationId","// * 会话ID\r"],type:["2","int","type","// * 会话类型：1单聊，2群聊\r"],memberCount:["3","int","memberCount","// * 群聊人数\r"],title:["4","string","title","// * 会话的标题\r"],icon:["5","string","icon","// * 会话显示的图片地址信息\r"],tag:["6","int","tag","// * 业务tag\r"],extension:["7",["Object","string","string"],"extension","// 扩展字段\r"],authority:["8","int","authority","// * 群加人权限，0-默认，群成员都可以加人，1-只有群主可以加人\r"],ownerId:["9","int","ownerId","// * 群主openId\r"]},COMMENT:"// 会话公共属性对象，不包含用户私有的属性\r"},BaseConversationModel:{def:{conversationId:["1","string","conversationId","// * 会话ID\r"],type:["2","int","type","// * 会话类型：1单聊，2群聊\r"],memberCount:["3","int","memberCount","// * 群聊人数\r"],title:["4","string","title","// * 会话的标题\r"],icon:["5","string","icon","// * 会话显示的图片地址信息\r"],extension:["6",["Object","string","string"],"extension","// 扩展字段\r"],createAt:["7","int","createAt","// 创建时间\r"],memberExtension:["8",["Object","string","string"],"memberExtension","// * 扩展字段\r"],notificationOff:["9","int","notificationOff","// * 会话是否接受通知消息 0-接收通知，1-表示关闭通知，不接收消息\r"],tag:["10","int","tag","// * 业务tag\r"],sort:["11","int","sort","// * 会话排序字段sort，数值越大排序越靠前，针对设置的用户有效\r"],status:["12","int","status","// * 0-隐藏，1-可见\r"],notificationSound:["13","string","notificationSound","// * 通知提醒音，notificationOff为0时有效\r"],authority:["14","int","authority","// * 群加人权限，0-默认，群成员都可以加人，1-只有群主可以加人\r"],ownerId:["15","int","ownerId","// * 群主openId\r"]},COMMENT:"// 基础会话对象\r"},ConversationModel:{def:{baseConversation:["1","BaseConversationModel","baseConversation","// * 基础会话对象\r"],lastMessages:["2",["Array","MessageModel"],"lastMessages","// * 最后N条消息\r"]},COMMENT:"// 基础会话对象\r"},ReconnectMessageModel:{def:{messageList:["1",["Array","MessageModel"],"messageList","// 消息列表\r"],readList:["2",["Array","DeliveryMessageStatusModel"],"readList","// 消息状态，针对消息发送者\r"],conversationList:["3",["Array","ConversationNotificationModel"],"conversationList","// 会话变更列表\r"],messageTagList:["4",["Array","MessageTagNoticeModel"],"messageTagList","// 消息tag变更列表\r"],readStatusList:["5",["Array","MessageReadStatusListModel"],"readStatusList","// * @Deprecated\r"],conversationPrivateList:["6",["Array","ConversationPrivateModel"],"conversationPrivateList","// 会话排序\r"],msgNoticeList:["8",["Array","MessageNoticeModel"],"msgNoticeList","// 消息变更通知\r"]},COMMENT:"// 客户端断线重连的推送消息，对应下行push topic：/s/reconn\r"},DeliveryMessageStatusModel:{def:{conversationId:["1","string","conversationId","// * 会话id\r"],messageId:["2","int","messageId","// * 消息id\r"],status:["3","SenderMessageStatusModel","status","// * 未读人数\r"],uuid:["4","string","uuid","// * 发送消息的uuid\r"]},COMMENT:"// 推送消息状态对象，对应下行push topic：/s/status\r"},ConversationNotificationModel:{def:{conversationId:["1","string","conversationId","// * 会话id\r"],memberCount:["2","int","memberCount","// * 群成员数\r"],title:["3","string","title","// * 群标题\r"],icon:["4","string","icon","// * 群icon\r"],isKicked:["5","boolean","isKicked","// * true 表示被踢\r"],tag:["6","int","tag","// * 业务tag\r"],extension:["7",["Object","string","string"],"extension","// * 扩展字段\r"],isQuit:["8","boolean","isQuit","// * true 主动退群\r"],isDisband:["9","boolean","isDisband","// * 是否解散群\r"],authority:["10","int","authority","// * 群加人权限，0-默认，群成员都可以加人，1-只有群主可以加人\r"]},COMMENT:"// 群聊成员、title和icon 变更推送，该消息只有推送通道，对应下行push topic：/s/convex\r"},MessageTagNoticeModel:{def:{conversationId:["1","string","conversationId","// * 会话id\r"],messageId:["2","int","messageId","// * 消息id\r"],memberTag:["3","int","memberTag","// * 业务tag\r"],memberExtension:["4",["Object","string","string"],"memberExtension","// * 每个人自己的extension\r"]},COMMENT:"// 业务推送的privateTag or privateExtension变更对象，对应下行push topic：/s/msgTag\r"},MessageNoticeModel:{def:{conversationId:["1","string","conversationId","// * 会话id\r"],messageId:["2","int","messageId","// * 消息id\r"],extension:["3",["Object","string","string"],"extension","// * extension\r"]},COMMENT:"// 业务推送的 extension变更对象, 对应下行push topic：/s/msgInfo\r"},AttachmentModel:{def:{type:["1","int","type","// * 类型\r"],url:["2","string","url","// * 链接\r"],size:["3","int","size","// * 大小（文件大小, byte）\r"],data:["4","byte[]","data","// * 字节数据\r"],isPreload:["5","boolean","isPreload","// * 是否预加载url\r"],extension:["6",["Object","string","string"],"extension","// * 扩展字段\r"]},COMMENT:"// 附件，contentType > 100 解析该字段\r"},DeliveryMessageReadStatusModel:{def:{conversationId:["1","string","conversationId","// * 会话id\r"],messageId:["2","int","messageId","// * 消息id\r"],status:["3","ReceiverMessageStatusModel","status","// * 针对接收者的消息状态，已读和未读\r"]},COMMENT:"// 消息已读状态对象，针对消息接受者，是为了同步web和客户端的read状态\r"},MessageReadStatusListModel:{def:{readStatusList:["1",["Array","DeliveryMessageReadStatusModel"],"readStatusList","// * 消息接受者的消息已读状态列表\r"]},COMMENT:"// 对应下行push topic：/s/readstatus\r"},XpnPushModel:{def:{sound:["1","string","sound","// * xpn声音字段\r"],action:["2","XpnActionModel","action","// * xpn统一跳转\r"],timeTolive:["3","int","timeTolive","// * xpn消息有效周期（ms）\r"],incrbadge:["4","int","incrbadge","// * xpn提示消息增量\r"],params:["5",["Object","string","string"],"params","// * xpn自定义参数\r"],alertContent:["6","string","alertContent","// * xpn推送消息内容\r"],isXpnOff:["7","int","isXpnOff","// * 是否关闭xpn\r"],templateId:["8","int","templateId","// * 模板ID\r"]},COMMENT:"// 服务端model。客户端请忽略\r"},XpnActionModel:{def:{templateKey:["1","string","templateKey","// * Action指定模板主键\r"],templateValue:["2","string","templateValue","// * Action指定模板替换值\r"]},COMMENT:"// 服务端model。客户端请忽略\r"},ConversationInfoModel:{def:{conversationId:["1","string","conversationId","// * 会话id\r"],tag:["2","int","tag","// * 业务tag\r"],extension:["3",["Object","string","string"],"extension","// * 扩展字段\r"]},COMMENT:"// 会话信息更新model\r"},ConversationPrivateModel:{def:{conversationId:["1","string","conversationId","// * 会话id\r"],sort:["2","int","sort","// * 会话排序字段sort，数值越大排序越靠前，针对设置的用户有效\r"],hide:["3","boolean","hide","// * 会话隐藏\r"],notificationOff:["4","int","notificationOff","// * 会话是否接受通知消息 0-接收通知，1-表示关闭通知，不接收消息\r"]},COMMENT:"// 会话排序model，对应下行push topic: /s/conp\r"}}),n.model.user=s({ProfileModel:{def:{openId:["1","int","openId"],nick:["2","string","nick"],nickPinyin:["3","string","nickPinyin"],gender:["4","int","gender"],avatar:["5","string","avatar"],remark:["6","string","remark"],dob:["7","int","dob"],city:["8","string","city"],stateCode:["9","string","stateCode"],mobile:["10","string","mobile"],isActive:["11","boolean","isActive"],ver:["12","int","ver"],extension:["13","string","extension"]}},AliasModel:{def:{openId:["1","int","openId"],alias:["2","string","alias"],pinyin:["3","string","pinyin","//别名内容"],audio:["4","string","audio","//备注名拼音"],extension:["5",["Object","string","string"],"extension","// 备注音"]}}})},{"./dist/IDLConversation":10,"./dist/IDLMessage":11,"./dist/IDLMessageStatus":12,"./dist/IDLSend":13,"./dist/OAuthI":14,"./dist/Sync":15,"./dist/UserI":16,"./keyPaddingGen":18}],18:[function(e,t,n){"use strict";var s=function(e){this.keys=this._processDef(e),this.paddings={};var t=this;Object.keys(e).forEach(function(e){t.paddings[e]=function(n){return t._padding(e,n)}})};s.prototype._padding=function(e,t){var n={},s=this;if(t&&this.keys[e]){var o=this.keys[e].keys;Object.keys(t).forEach(function(e){var i=parseInt(e);if(o[i]){var r=o[i].name,a=o[i].type;if("string"==typeof a&&s.keys[a])var c=s._padding(a,t[e]);else if(Array.isArray(a))if("Array"===a[0]&&s.keys[a[1]])var c=t[e].map(function(e){return s._padding(a[1],e)});else var c=t[e];else var c=t[e];n[r]=c}})}return n},s.prototype._processDef=function(e){var t={};return Object.keys(e).forEach(function(n){var s={};Object.keys(e[n].def).forEach(function(t){var o=e[n].def[t];s[parseInt(o[0])]={type:o[1],name:t}}),t[n]={keys:s}}),t};var o=function(e){return new s(e)};t.exports=o},{}],19:[function(e,t,n){"use strict";var s={DID:"wk_device_id"},o={getItem:function(e){return window.sessionStorage.getItem(e)},setItem:function(e,t){return window.sessionStorage.setItem(e,t)},removeItem:function(e){return window.sessionStorage.removeItem(e)},clear:function(){return window.sessionStorage.clear()}},i={getItem:function(e){return window.localStorage.getItem(e)},setItem:function(e,t){return window.localStorage.setItem(e,t)},removeItem:function(e){return window.localStorage.removeItem(e)},clear:function(){return window.localStorage.clear()}};t.exports={KEYS:s,session:o,local:i}},{}],20:[function(e,t,n){"use strict";function s(e){function t(e,t){var n=t.onSyncMsg||function(){},s=t.onNeedPullData||function(){return Promise.resolve()};return l.addListener(m+e,n),g.push(s),function(){l.removeListener(m+e,n);var t=g.indexOf(s);t>-1&&g.splice(t,1)}}function n(){var e=r.getSyncInfo();f.getState([e],function(e){200===e.code?g.length>0?Promise.all(g.map(function(e){return e()})).then(function(){a.info("sync : pull data success"),r.setSyncInfo(e.body),s()},function(t){a.info("sync : pull data fail :"+JSON.stringify(t)),r.setSyncInfo(e.body),s()}):(a.info("pullDataCallbacks is an empty array"),r.setSyncInfo(e.body),s()):a.error("sync : getState fail "+JSON.stringify(e))})}function s(){var e=r.getSyncInfo();f.getDiff([e],function(e){200===e.code?(h=0,r.setSyncInfo({pts:e.body.maxPts,seq:e.body.endSeq,timestamp:e.body.timestamp}),e.body.data&&Array.isArray(e.body.data)&&u(e.body.data),e.body.hasMore?(a.info("sync : getDiff , but hasMore is true , getDiff one more"),s()):(a.info("sync : get diff end , try ack"),d())):(h++,h>v?a.error("sync : getDiff error"):(a.error("sync : getDiff error, but try one more"),s()))})}function d(){var e=r.getSyncInfo();f.ackDiff([e],function(e){a.info("sync ackDiff result: "+JSON.stringify(e))})}function u(e){e.forEach(function(e){var t=e.objectType;try{var n=msgpack.decodeFromB64(e.data);p[t]&&(n=p[t](n)),l.emitEvent(m+t,[n])}catch(s){a.error(s.toString()+" | Scene : decode sync data , data:"+e.data)}a.info("sync receive msg with objectType "+t)})}var l=new i,f=o["interface"].Sync(e.ws),g=[],p={};p[c.RELATION_ALIAS]=o.model.user.paddings.AliasModel;var m="syncProtocol-",v=5,h=0;this.onChange=function(e,t){t({});var o=syncPadding.paddings.SyncPushModel(e.body);o.syncExtraType&&2===o.syncExtraType.type&&(n(),a.info("sync : receive sync msg, too long = 2")),o.syncExtraType&&1===o.syncExtraType.type&&(s(),a.info("sync : receive sync msg, too long = 1")),o.syncPushPackage&&o.syncPushPackage.data&&u(o.syncPushPackage.data)},t("msg",{onSyncMsg:function(e){console.log(e)}}),this.getState=function(){n()}}var o=(e("../tools/method"),e("../net/entry")),i=e("wolfy87-eventemitter"),r=e("./syncState"),a=e("../tools/log"),c={RELATION_ALIAS:2501};t.exports=s},{"../net/entry":17,"../tools/log":25,"../tools/method":27,"./syncState":21,"wolfy87-eventemitter":36}],21:[function(e,t,n){"use strict";var s=e("../tools/method"),o={pts:0,seq:0,timestamp:0};n.getSyncInfo=function(){return o},n.setSyncInfo=function(e){return s.assign(o,e),o}},{"../tools/method":27}],22:[function(e,t,n){"use strict";var s=e("uuid"),o=e("../storage/storage");n.getDid=function(){var e=o.session.getItem(o.KEYS.DID);if(e)return e;var e=s.v4().replace(/\-/g,"");return o.session.setItem(o.KEYS.DID,e),e}},{"../storage/storage":19,uuid:35}],23:[function(e,t,n){function s(){"function"!=typeof Array.prototype.forEach&&(Array.prototype.forEach=function(e,t){for(var n=0,s=this.length;s>n;n++)"function"==typeof e&&Object.prototype.hasOwnProperty.call(this,n)&&e.call(t,this[n],n,this)})}s()},{}],24:[function(e,t,n){t.exports=function(){function e(e){return"on"+e.substring(0,1).toUpperCase()+e.substring(1)}var t={};return t.on=function(t,n){this[e(t)]=n||function(){}},t.trigger=function(t){var n=[].slice.call(arguments);n.shift(),this[e(t)]&&this[e(t)].apply(this,n)},t.off=function(t){delete this[e(t)]},t}},{}],25:[function(e,t,n){"use strict";function s(e,t){console[e](e,t);var n=+new Date;if(o.local.getItem("WKlog")&&(a=JSON.parse(o.local.getItem("WKlog"))),a[e+"_"+n]=t,o.local.setItem("WKlog",JSON.stringify(a)),window.aliwukongCollectLogUrl){var s="did:"+i.getDid()+" type:"+e+" log:"+t;r(window.aliwukongCollectLogUrl+"?log="+s,{})}}var o=e("../storage/storage"),i=e("./deviceId"),r=e("jsonp"),a={did:i.getDid()};t.exports={info:function(){var e=JSON.stringify(arguments);s("info",e)},error:function(){var e=JSON.stringify(arguments);s("error",e)},warn:function(){var e=JSON.stringify(arguments);s("warn",e)}}},{"../storage/storage":19,"./deviceId":22,jsonp:30}],26:[function(e,t,n){!function(){"use strict";function e(e,t,n){for(var s="",o=t,i=t+n;i>o;o++){var r=e.getUint8(o);if(0!==(128&r))if(192!==(224&r))if(224!==(240&r)){if(240!==(248&r))throw new Error("Invalid byte "+r.toString(16));s+=String.fromCharCode((7&r)<<18|(63&e.getUint8(++o))<<12|(63&e.getUint8(++o))<<6|(63&e.getUint8(++o))<<0)}else s+=String.fromCharCode((15&r)<<12|(63&e.getUint8(++o))<<6|(63&e.getUint8(++o))<<0);else s+=String.fromCharCode((15&r)<<6|63&e.getUint8(++o));else s+=String.fromCharCode(r)}return s}function t(e,t){this.offset=t||0,this.view=e}function n(e){var n=new DataView(e),s=new t(n),o=s.parse();if(s.offset!==e.byteLength)throw new Error(e.byteLength-s.offset+" trailing bytes");return o}t.prototype.map=function(e){for(var t={},n=0;e>n;n++){var s=this.parse();t[s]=this.parse()}return t},t.prototype.buf=function(e){var t=new ArrayBuffer(e);return new Uint8Array(t).set(new Uint8Array(this.view.buffer,this.offset,e),0),this.offset+=e,t},t.prototype.raw=function(t){var n=e(this.view,this.offset,t);return this.offset+=t,n},t.prototype.array=function(e){for(var t=new Array(e),n=0;e>n;n++)t[n]=this.parse();return t},t.prototype.parse=function(){var e,t,n=this.view.getUint8(this.offset);if(160===(224&n))return t=31&n,this.offset++,this.raw(t);if(128===(240&n))return t=15&n,this.offset++,this.map(t);if(144===(240&n))return t=15&n,this.offset++,this.array(t);if(0===(128&n))return this.offset++,n;if(224===(224&n))return e=this.view.getInt8(this.offset),this.offset++,e;switch(n){case 218:return t=this.view.getUint16(this.offset+1),this.offset+=3,this.raw(t);case 219:return t=this.view.getUint32(this.offset+1),this.offset+=5,this.raw(t);case 192:return this.offset++,null;case 194:return this.offset++,!1;case 195:return this.offset++,!0;case 196:return void this.offset++;case 204:return e=this.view.getUint8(this.offset+1),this.offset+=2,e;case 205:return e=this.view.getUint16(this.offset+1),this.offset+=3,e;case 206:return e=this.view.getUint32(this.offset+1),this.offset+=5,e;case 208:return e=this.view.getInt8(this.offset+1),this.offset+=2,e;case 209:return e=this.view.getInt16(this.offset+1),this.offset+=3,e;case 210:return e=this.view.getInt32(this.offset+1),this.offset+=5,e;case 222:return t=this.view.getUint16(this.offset+1),this.offset+=3,this.map(t);case 223:return t=this.view.getUint32(this.offset+1),this.offset+=5,this.map(t);case 220:return t=this.view.getUint16(this.offset+1),this.offset+=3,this.array(t);case 221:return t=this.view.getUint32(this.offset+1),this.offset+=5,this.array(t);case 216:return t=this.view.getUint16(this.offset+1),this.offset+=3,this.buf(t);case 217:return t=this.view.getUint32(this.offset+1),this.offset+=5,this.buf(t);case 202:return e=this.view.getFloat32(this.offset+1),this.offset+=5,e;case 203:return e=this.view.getFloat64(this.offset+1),this.offset+=9,e}throw new Error("Unknown type 0x"+n.toString(16))},window.base64={};var s=function(e){for(var t=window.atob(e),n=t.length,s=new Uint8Array(n),o=0;n>o;o++){var i=t.charCodeAt(o);s[o]=i}return s.buffer};base64.msgPackB64ToObj=function(e){var t={};try{t=n(s(e))}catch(o){t={}}return t}}(),t.exports=function(e){var t="https://i01.lw.aliimg.com/media/",n=function(e){switch(e){case 0:return"IMAGE_JPG";case 1:return"IMAGE_GIF";case 2:return"IMAGE_PNG";case 3:return"IMAGE_BMP";case 4:return"AUDIO_AMR";case 5:return"AUDIO_MP3";case 6:return"VIDEO_MP4";case 7:return"AUDIO_WAV";case 8:return"NORMAL_FILE";case 9:return"OFFICE_DOC";case 10:return"OFFICE_DOCX";case 11:return"OFFICE_XLS";case 12:return"OFFICE_XLSX";case 13:return"OFFICE_PPT";case 14:return"OFFICE_PPTX";case 15:return"NORMAL_ZIP";case 16:return"NORMAL_PDF";case 17:return"NORMAL_RAR";default:return"NORMAL_FILE"}};if(e=e.replace(/-/gi,"+").replace(/_/gi,"/"),"@"!==e.charAt(0))return console.log("mid format error :"+e),null;var e=e.substr(1),s=base64.msgPackB64ToObj(e),o=n(s[0]).split("_");if("IMAGE"===o[0])var i=e+"_"+s[3]+"_"+s[2]+"."+o[1].toLowerCase();else var i=e+"."+o[1].toLowerCase();return i=i.replace(/\//gi,"_").replace(/\+/gi,"-"),t+i}},{}],27:[function(e,t,n){t.exports={getUUID:function(e){var t,n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),s=[],e=e||16;for(t=0;e>t;t++)s[t]=n[0|Math.random()*e];return s.join("")},uniqueOpenId:function(e){for(var t=[],n={},s=0;s<e.length;s++)n[e[s].openIdEx.openId]=e[s];for(var s in n)t.push(n[s]);return t},uniqueMessages:function(e){for(var t,n=[],s={},o=0;null!=(t=e[o]);o++)s[t]||(n.push(t),s[t]=!0);return n},uniqueConversation:function(e){for(var t=[],n={},s=0;s<e.length;s++)n[e[s]]="empty";for(var s in n)t.push(s);return t},has:function(e,t){return this.get(e,t)?!0:!1},assign:function(e,t,n){if(!t)return e;for(var s=Object.keys(t),o=0;o<s.length;)(!n||n&&void 0===e[s[o]])&&(e[s[o]]=t[s[o]]),o++;return e},isObject:function(e){var t=typeof e;return!!e&&("object"==t||"function"==t)},isString:function(e){return"string"==typeof e?!0:!1},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},isEmpty:function(e){return null==e||""==e||"[]"==JSON.stringify(e)||"{}"==JSON.stringify(e)||"undefined"==e||void 0==e?!0:!1},get:function(e,t,n){function s(e,t,n){if(null!=e){void 0!==n&&n in o(e)&&(t=[n]);for(var s=0,i=t.length;null!=e&&i>s;)e=e[t[s++]];return s&&s==i?e:void 0}}function o(e){return a.isObject(e)?e:Object(e)}function i(e){return"string"==typeof e?e:null==e?"":e+""}function r(e){if(a.isArray(e))return e;var t=[];return i(e).replace(c,function(e,n,s,o){t.push(s?o.replace(d,"$1"):n||e)}),t}var a=this,c=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,d=/\\(\\)?/g,u=null==e?void 0:s(e,r(t),t+"");return void 0===u?n:u},parseImgSize:function(e){if(!e)return null;var t=e.match(/([\d]+_[\d]+)/g);if(!t)return null;var n=[];return-1!=t[0].indexOf("_")&&(n=t[0].split("_")),n}}},{}],28:[function(e,t,n){function s(e){this._im=e}var o=e("../tools/deviceId"),i=e("../io/ws"),r=function(e){return{pre:function(t,n){n=n||function(){},e.sendMsg("/up/pre",{did:o.getDid(),dt:"j","up-req":"-1;-1;0;flag=mi;","net-type":"wifi"},"",!1,function(t){200==t.code?n({upId:t.headers["up-resp"],upUid:t.headers.uip}):(console.error(t),e.forceClose())})},ci:function(t,n,s){s=s||function(){},e.sendMsg("/up/ci",{did:o.getDid(),dt:"b","up-req":t.upId.split("&")[0]+";0;0;flag=mi;","net-type":"wifi",uip:t.upUid},n,!1,function(t){200==t.code?s(t):console.error(t),e.forceClose()})},trans:function(t,n){e.sendMsg("/up/trans",{},{src:t,dstType:5},!1,function(t){200==t.code||console.error(t),n(t),e.forceClose()})}}};s.prototype.uploadImg=function(e,t){var n=this,s=new i("upload",{appKey:n._im.appKey,ua:n._im.ua,WSURL:n._im.WSURL},{onReged:function(){var n=r(s);n.pre("",function(s){n.ci(s,e,function(e){t({success:!0,body:e.body})})})}});s.connect()},s.prototype.trans=function(e,t){var n=this,s=new i("trans",{appKey:n._im.appKey,ua:n._im.ua,WSURL:n._im.WSURL},{onReged:function(){var n=r(s);n.trans(e,function(e){t(e)})}});s.connect()},t.exports=s},{"../io/ws":6,"../tools/deviceId":22}],29:[function(e,t,n){function s(e){this._im=e,this._UserI=o["interface"].UserI(e.ws)}var o=(e("../../libs/tools/log"),e("../net/entry")),i=e("../tools/method");s.prototype.getProfile=function(e,t){var n=this;t=t||function(){},i.isArray(e)||(e=[e]);var s=[],o=[];return e.forEach(function(e){n._im._data_userProfiles[e]?o.push(n._im._data_userProfiles[e]):s.push(e)}),s[0]?void this._UserI.getUserProfilesByOpenIds([s],function(e){200==e.code&&e.body.forEach(function(e){n._im._data_userProfiles[e.openId]=e,o.push(e)}),e.body=o,t(e)}):void t({body:o,code:200})},s.prototype.updateProfile=function(e,t){e=e||{},e.openId=this._im.openId,this._UserI.updateUserProfile([e],function(e){200==e.code?t&&t(e):console.log("updateProfile fail",e)})},t.exports=s},{"../../libs/tools/log":25,"../net/entry":17,"../tools/method":27}],30:[function(e,t,n){function s(){}function o(e,t,n){function o(){c.parentNode&&c.parentNode.removeChild(c),window[l]=s,d&&clearTimeout(d)}function a(){window[l]&&o()}"function"==typeof t&&(n=t,t={}),t||(t={});var c,d,u=t.prefix||"__jp",l=t.name||u+r++,f=t.param||"callback",g=null!=t.timeout?t.timeout:6e4,p=encodeURIComponent,m=document.getElementsByTagName("script")[0]||document.head;return g&&(d=setTimeout(function(){o(),n&&n(new Error("Timeout"))},g)),window[l]=function(e){i("jsonp got",e),o(),n&&n(null,e)},e+=(~e.indexOf("?")?"&":"?")+f+"="+p(l),e=e.replace("?&","?"),i('jsonp req "%s"',e),c=document.createElement("script"),c.src=e,m.parentNode.insertBefore(c,m),a}var i=e("debug")("jsonp");t.exports=o;var r=0},{debug:31}],31:[function(e,t,n){function s(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function o(){var e=arguments,t=this.useColors;
if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+n.humanize(this.diff),!t)return e;var s="color: "+this.color;e=[e[0],s,"color: inherit"].concat(Array.prototype.slice.call(e,1));var o=0,i=0;return e[0].replace(/%[a-z%]/g,function(e){"%%"!==e&&(o++,"%c"===e&&(i=o))}),e.splice(i,0,s),e}function i(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function r(e){try{null==e?d.removeItem("debug"):d.debug=e}catch(t){}}function a(){var e;try{e=d.debug}catch(t){}return e}function c(){try{return window.localStorage}catch(e){}}n=t.exports=e("./debug"),n.log=i,n.formatArgs=o,n.save=r,n.load=a,n.useColors=s;var d;d="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:c(),n.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],n.formatters.j=function(e){return JSON.stringify(e)},n.enable(a())},{"./debug":32}],32:[function(e,t,n){function s(){return n.colors[u++%n.colors.length]}function o(e){function t(){}function o(){var e=o,t=+new Date,i=t-(d||t);e.diff=i,e.prev=d,e.curr=t,d=t,null==e.useColors&&(e.useColors=n.useColors()),null==e.color&&e.useColors&&(e.color=s());var r=Array.prototype.slice.call(arguments);r[0]=n.coerce(r[0]),"string"!=typeof r[0]&&(r=["%o"].concat(r));var a=0;r[0]=r[0].replace(/%([a-z%])/g,function(t,s){if("%%"===t)return t;a++;var o=n.formatters[s];if("function"==typeof o){var i=r[a];t=o.call(e,i),r.splice(a,1),a--}return t}),"function"==typeof n.formatArgs&&(r=n.formatArgs.apply(e,r));var c=o.log||n.log||console.log.bind(console);c.apply(e,r)}t.enabled=!1,o.enabled=!0;var i=n.enabled(e)?o:t;return i.namespace=e,i}function i(e){n.save(e);for(var t=(e||"").split(/[\s,]+/),s=t.length,o=0;s>o;o++)t[o]&&(e=t[o].replace(/\*/g,".*?"),"-"===e[0]?n.skips.push(new RegExp("^"+e.substr(1)+"$")):n.names.push(new RegExp("^"+e+"$")))}function r(){n.enable("")}function a(e){var t,s;for(t=0,s=n.skips.length;s>t;t++)if(n.skips[t].test(e))return!1;for(t=0,s=n.names.length;s>t;t++)if(n.names[t].test(e))return!0;return!1}function c(e){return e instanceof Error?e.stack||e.message:e}n=t.exports=o,n.coerce=c,n.disable=r,n.enable=i,n.enabled=a,n.humanize=e("ms"),n.names=[],n.skips=[],n.formatters={};var d,u=0},{ms:33}],33:[function(e,t,n){function s(e){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var n=parseFloat(t[1]),s=(t[2]||"ms").toLowerCase();switch(s){case"years":case"year":case"yrs":case"yr":case"y":return n*l;case"days":case"day":case"d":return n*u;case"hours":case"hour":case"hrs":case"hr":case"h":return n*d;case"minutes":case"minute":case"mins":case"min":case"m":return n*c;case"seconds":case"second":case"secs":case"sec":case"s":return n*a;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n}}}function o(e){return e>=u?Math.round(e/u)+"d":e>=d?Math.round(e/d)+"h":e>=c?Math.round(e/c)+"m":e>=a?Math.round(e/a)+"s":e+"ms"}function i(e){return r(e,u,"day")||r(e,d,"hour")||r(e,c,"minute")||r(e,a,"second")||e+" ms"}function r(e,t,n){return t>e?void 0:1.5*t>e?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}var a=1e3,c=60*a,d=60*c,u=24*d,l=365.25*u;t.exports=function(e,t){return t=t||{},"string"==typeof e?s(e):t["long"]?i(e):o(e)}},{}],34:[function(e,t,n){(function(e){var n;if(e.crypto&&crypto.getRandomValues){var s=new Uint8Array(16);n=function(){return crypto.getRandomValues(s),s}}if(!n){var o=new Array(16);n=function(){for(var e,t=0;16>t;t++)0===(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}t.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],35:[function(e,t,n){function s(e,t,n){var s=t&&n||0,o=0;for(t=t||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){16>o&&(t[s+o++]=d[e])});16>o;)t[s+o++]=0;return t}function o(e,t){var n=t||0,s=c;return s[e[n++]]+s[e[n++]]+s[e[n++]]+s[e[n++]]+"-"+s[e[n++]]+s[e[n++]]+"-"+s[e[n++]]+s[e[n++]]+"-"+s[e[n++]]+s[e[n++]]+"-"+s[e[n++]]+s[e[n++]]+s[e[n++]]+s[e[n++]]+s[e[n++]]+s[e[n++]]}function i(e,t,n){var s=t&&n||0,i=t||[];e=e||{};var r=void 0!==e.clockseq?e.clockseq:g,a=void 0!==e.msecs?e.msecs:(new Date).getTime(),c=void 0!==e.nsecs?e.nsecs:m+1,d=a-p+(c-m)/1e4;if(0>d&&void 0===e.clockseq&&(r=r+1&16383),(0>d||a>p)&&void 0===e.nsecs&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");p=a,m=c,g=r,a+=122192928e5;var u=(1e4*(268435455&a)+c)%4294967296;i[s++]=u>>>24&255,i[s++]=u>>>16&255,i[s++]=u>>>8&255,i[s++]=255&u;var l=a/4294967296*1e4&268435455;i[s++]=l>>>8&255,i[s++]=255&l,i[s++]=l>>>24&15|16,i[s++]=l>>>16&255,i[s++]=r>>>8|128,i[s++]=255&r;for(var v=e.node||f,h=0;6>h;h++)i[s+h]=v[h];return t?t:o(i)}function r(e,t,n){var s=t&&n||0;"string"==typeof e&&(t="binary"==e?new Array(16):null,e=null),e=e||{};var i=e.random||(e.rng||a)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t)for(var r=0;16>r;r++)t[s+r]=i[r];return t||o(i)}for(var a=e("./rng"),c=[],d={},u=0;256>u;u++)c[u]=(u+256).toString(16).substr(1),d[c[u]]=u;var l=a(),f=[1|l[0],l[1],l[2],l[3],l[4],l[5]],g=16383&(l[6]<<8|l[7]),p=0,m=0,v=r;v.v1=i,v.v4=r,v.parse=s,v.unparse=o,t.exports=v},{"./rng":34}],36:[function(e,t,n){(function(){"use strict";function e(){}function n(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}function s(e){return function(){return this[e].apply(this,arguments)}}var o=e.prototype,i=this,r=i.EventEmitter;o.getListeners=function(e){var t,n,s=this._getEvents();if(e instanceof RegExp){t={};for(n in s)s.hasOwnProperty(n)&&e.test(n)&&(t[n]=s[n])}else t=s[e]||(s[e]=[]);return t},o.flattenListeners=function(e){var t,n=[];for(t=0;t<e.length;t+=1)n.push(e[t].listener);return n},o.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&(t={},t[e]=n),t||n},o.addListener=function(e,t){var s,o=this.getListenersAsObject(e),i="object"==typeof t;for(s in o)o.hasOwnProperty(s)&&-1===n(o[s],t)&&o[s].push(i?t:{listener:t,once:!1});return this},o.on=s("addListener"),o.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},o.once=s("addOnceListener"),o.defineEvent=function(e){return this.getListeners(e),this},o.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},o.removeListener=function(e,t){var s,o,i=this.getListenersAsObject(e);for(o in i)i.hasOwnProperty(o)&&(s=n(i[o],t),-1!==s&&i[o].splice(s,1));return this},o.off=s("removeListener"),o.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},o.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},o.manipulateListeners=function(e,t,n){var s,o,i=e?this.removeListener:this.addListener,r=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(s=n.length;s--;)i.call(this,t,n[s]);else for(s in t)t.hasOwnProperty(s)&&(o=t[s])&&("function"==typeof o?i.call(this,s,o):r.call(this,s,o));return this},o.removeEvent=function(e){var t,n=typeof e,s=this._getEvents();if("string"===n)delete s[e];else if(e instanceof RegExp)for(t in s)s.hasOwnProperty(t)&&e.test(t)&&delete s[t];else delete this._events;return this},o.removeAllListeners=s("removeEvent"),o.emitEvent=function(e,t){var n,s,o,i,r=this.getListenersAsObject(e);for(o in r)if(r.hasOwnProperty(o))for(s=r[o].length;s--;)n=r[o][s],n.once===!0&&this.removeListener(e,n.listener),i=n.listener.apply(this,t||[]),i===this._getOnceReturnValue()&&this.removeListener(e,n.listener);return this},o.trigger=s("emitEvent"),o.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},o.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},o._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},o._getEvents=function(){return this._events||(this._events={})},e.noConflict=function(){return i.EventEmitter=r,e},"function"==typeof define&&define.amd?define(function(){return e}):"object"==typeof t&&t.exports?t.exports=e:i.EventEmitter=e}).call(this)},{}]},{},[7]);